<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Knowledge Graph </title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1a202c;
        }

        .app-container {
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
        }

        .header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo i {
            font-size: 2rem;
            color: #68d391;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 2rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-tab:hover, .nav-tab.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .search-section {
            background: white;
            border-radius: 2rem;
            padding: 3rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .search-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .search-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .search-subtitle {
            color: #718096;
            font-size: 1.1rem;
        }

        .search-form {
            display: grid;
            gap: 1.5rem;
        }

        .search-input-group {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem 1rem 3rem;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: #f7fafc;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
            font-size: 1.2rem;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select, .filter-input {
            padding: 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s ease; 
            background: white;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .range-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .search-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .search-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            background: white;
            border-radius: 2rem;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f7fafc;
        }

        .results-count {
            font-size: 1.2rem;
            font-weight: 600;
            color: #4a5568;
        }

        .sort-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }

        .food-card {
            background: white;
            border-radius: 1.5rem;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .food-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .food-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0aec0;
            font-size: 3rem;
            position: relative;
        }

        .food-card-content {
            padding: 1.5rem;
        }

        .food-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .food-class {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .nutrition-item {
            background: #f7fafc;
            padding: 0.75rem;
            border-radius: 0.75rem;
            text-align: center;
        }

        .nutrition-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #667eea;
        }

        .nutrition-label {
            font-size: 0.8rem;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 3rem;
        }

        .pagination-button {
            padding: 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .pagination-button:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
            color: #667eea;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #718096;
        }

        .empty-state i {
            font-size: 4rem;
            color: #e2e8f0;
            margin-bottom: 1rem;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            margin-top: 0.25rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .autocomplete-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .autocomplete-item:hover {
            background: #f7fafc;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .search-title {
                font-size: 2rem;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .food-grid {
                grid-template-columns: 1fr;
            }

            .results-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Configuration API
        const API_BASE_URL = 'http://localhost:8080/api';

        // Composant principal
        function App() {
            const [activeTab, setActiveTab] = useState('search');
            const [searchQuery, setSearchQuery] = useState('');
            const [filters, setFilters] = useState({
                foodClass: '',
                foodGroup: '',
                minCalories: '',
                maxCalories: '',
                minProtein: '',
                maxProtein: ''
            });
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [pagination, setPagination] = useState({
                currentPage: 0,
                totalPages: 0,
                totalElements: 0,
                size: 20
            });
            const [sortBy, setSortBy] = useState('name');
            const [sortDirection, setSortDirection] = useState('asc');
            const [foodClasses, setFoodClasses] = useState([]);
            const [foodGroups, setFoodGroups] = useState([]);
            const [autocomplete, setAutocomplete] = useState([]);
            const [showAutocomplete, setShowAutocomplete] = useState(false);

            // Charger les classes et groupes d'aliments
            useEffect(() => {
                Promise.all([
                    fetch(`${API_BASE_URL}/foods/classes`).then(r => r.json()),
                    fetch(`${API_BASE_URL}/foods/groups`).then(r => r.json())
                ]).then(([classes, groups]) => {
                    setFoodClasses(classes);
                    setFoodGroups(groups);
                }).catch(console.error);
            }, []);

            // Autocomplétion
            const handleAutocomplete = useCallback(async (query) => {
                if (query.length < 2) {
                    setAutocomplete([]);
                    setShowAutocomplete(false);
                    return;
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/foods/autocomplete?query=${encodeURIComponent(query)}`);
                    const suggestions = await response.json();
                    setAutocomplete(suggestions);
                    setShowAutocomplete(true);
                } catch (error) {
                    console.error('Erreur autocomplétion:', error);
                }
            }, []);

            // Recherche
            const handleSearch = async (page = 0) => {
                setLoading(true);
                try {
                    const searchParams = new URLSearchParams({
                        page: page.toString(),
                        size: pagination.size.toString(),
                        sortBy,
                        sortDirection
                    });

                    if (searchQuery.trim()) searchParams.append('query', searchQuery);
                    if (filters.foodClass) searchParams.append('foodClass', filters.foodClass);
                    if (filters.foodGroup) searchParams.append('foodGroup', filters.foodGroup);
                    if (filters.minCalories) searchParams.append('minCalories', filters.minCalories);
                    if (filters.maxCalories) searchParams.append('maxCalories', filters.maxCalories);
                    if (filters.minProtein) searchParams.append('minProtein', filters.minProtein);
                    if (filters.maxProtein) searchParams.append('maxProtein', filters.maxProtein);

                    const response = await fetch(`${API_BASE_URL}/foods/search?${searchParams}`);
                    const data = await response.json();

                    setResults(data.foods || []);
                    setPagination({
                        currentPage: data.currentPage || 0,
                        totalPages: data.totalPages || 0,
                        totalElements: data.totalElements || 0,
                        size: data.size || 20
                    });
                } catch (error) {
                    console.error('Erreur de recherche:', error);
                    setResults([]);
                } finally {
                    setLoading(false);
                }
            };

            const updateFilter = (key, value) => {
                setFilters(prev => ({ ...prev, [key]: value }));
            };

            const resetFilters = () => {
                setSearchQuery('');
                setFilters({
                    foodClass: '',
                    foodGroup: '',
                    minCalories: '',
                    maxCalories: '',
                    minProtein: '',
                    maxProtein: ''
                });
            };

            return (
    <div className="app-container">
        <Header activeTab={activeTab} setActiveTab={setActiveTab} />
        
        <main className="main-content">
            {activeTab === 'search' && (
                <>
                    <SearchSection
                        searchQuery={searchQuery}
                        setSearchQuery={setSearchQuery}
                        filters={filters}
                        updateFilter={updateFilter}
                        resetFilters={resetFilters}
                        handleSearch={handleSearch}
                        loading={loading}
                        foodClasses={foodClasses}
                        foodGroups={foodGroups}
                        autocomplete={autocomplete}
                        showAutocomplete={showAutocomplete}
                        setShowAutocomplete={setShowAutocomplete}
                        handleAutocomplete={handleAutocomplete}
                    />
                    
                    <ResultsSection
                        results={results}
                        loading={loading}
                        pagination={pagination}
                        handleSearch={handleSearch}
                        sortBy={sortBy}
                        setSortBy={setSortBy}
                        sortDirection={sortDirection}
                        setSortDirection={setSortDirection}
                    />
                </>
            )}
            
            {activeTab === 'admin' && <AdminSection />}
        </main>
    </div>
);
        }

        // Composant Header
        function Header({ activeTab, setActiveTab }) {
            return (
                <header className="header">
                    <div className="header-content">
                        <div className="logo">
                            <i className="fas fa-utensils"></i>
                            <span>Food Knowledge Graph by Spring_Shogün 🍃</span>
                        </div>
                        <nav className="nav-tabs">
                            <button 
                                className={`nav-tab ${activeTab === 'search' ? 'active' : ''}`}
                                onClick={() => setActiveTab('search')}
                            >
                                <i className="fas fa-search"></i> Recherche
                            </button>
                            <button 
                                className={`nav-tab ${activeTab === 'admin' ? 'active' : ''}`}
                                onClick={() => setActiveTab('admin')}
                            >
                                <i className="fas fa-cog"></i> Administration
                            </button>
                        </nav>
                    </div>
                </header>
            );
        }

        // Composant de recherche
        function SearchSection({ 
            searchQuery, setSearchQuery, filters, updateFilter, resetFilters, 
            handleSearch, loading, foodClasses, foodGroups, autocomplete, 
            showAutocomplete, setShowAutocomplete, handleAutocomplete 
        }) {
            return (
                <div className="search-section">
                    <div className="search-header">
                        <h1 className="search-title">Explorez les Aliments</h1>
                        <p className="search-subtitle">
                            Découvrez les propriétés nutritionnelles et les informations détaillées des aliments
                        </p>
                    </div>

                    <div className="search-form">
                        <div className="search-input-group">
                            <i className="fas fa-search search-icon"></i>
                            <input
                                type="text"
                                className="search-input"
                                placeholder="Rechercher un aliment (ex: pomme, fromage, pain...)"
                                value={searchQuery}
                                onChange={(e) => {
                                    setSearchQuery(e.target.value);
                                    handleAutocomplete(e.target.value);
                                }}
                                onFocus={() => setShowAutocomplete(true)}
                                onBlur={() => setTimeout(() => setShowAutocomplete(false), 200)}
                            />
                            {showAutocomplete && autocomplete.length > 0 && (
                                <div className="autocomplete-dropdown">
                                    {autocomplete.map((suggestion, index) => (
                                        <div
                                            key={index}
                                            className="autocomplete-item"
                                            onClick={() => {
                                                setSearchQuery(suggestion);
                                                setShowAutocomplete(false);
                                            }}
                                        >
                                            {suggestion}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        <div className="filters-grid">
                            <div className="filter-group">
                                <label className="filter-label">Classe d'aliment</label>
                                <select
                                    className="filter-select"
                                    value={filters.foodClass}
                                    onChange={(e) => updateFilter('foodClass', e.target.value)}
                                >
                                    <option value="">Toutes les classes</option>
                                    {foodClasses.map(cls => (
                                        <option key={cls} value={cls}>{cls}</option>
                                    ))}
                                </select>
                            </div>

                            <div className="filter-group">
                                <label className="filter-label">Groupe alimentaire</label>
                                <select
                                    className="filter-select"
                                    value={filters.foodGroup}
                                    onChange={(e) => updateFilter('foodGroup', e.target.value)}
                                >
                                    <option value="">Tous les groupes</option>
                                    {foodGroups.map(group => (
                                        <option key={group} value={group}>{group}</option>
                                    ))}
                                </select>
                            </div>

                            <div className="filter-group">
                                <label className="filter-label">Calories (kcal/100g)</label>
                                <div className="range-inputs">
                                    <input
                                        type="number"
                                        className="filter-input"
                                        placeholder="Min"
                                        value={filters.minCalories}
                                        onChange={(e) => updateFilter('minCalories', e.target.value)}
                                    />
                                    <input
                                        type="number"
                                        className="filter-input"
                                        placeholder="Max"
                                        value={filters.maxCalories}
                                        onChange={(e) => updateFilter('maxCalories', e.target.value)}
                                    />
                                </div>
                            </div>

                            <div className="filter-group">
                                <label className="filter-label">Protéines (g/100g)</label>
                                <div className="range-inputs">
                                    <input
                                        type="number"
                                        className="filter-input"
                                        placeholder="Min"
                                        value={filters.minProtein}
                                        onChange={(e) => updateFilter('minProtein', e.target.value)}
                                    />
                                    <input
                                        type="number"
                                        className="filter-input"
                                        placeholder="Max"
                                        value={filters.maxProtein}
                                        onChange={(e) => updateFilter('maxProtein', e.target.value)}
                                    />
                                </div>
                            </div>
                        </div>

                        <div style={{ display: 'flex', gap: '1rem' }}>
                            <button
                                className="search-button"
                                onClick={() => handleSearch(0)}
                                disabled={loading}
                                style={{ flex: 1 }}
                            >
                                {loading ? (
                                    <>
                                        <i className="fas fa-spinner fa-spin"></i>
                                        Recherche en cours...
                                    </>
                                ) : (
                                    <>
                                        <i className="fas fa-search"></i>
                                        Rechercher
                                    </>
                                )}
                            </button>
                            
                            <button
                                className="search-button"
                                onClick={resetFilters}
                                style={{ 
                                    flex: 'none',
                                    background: 'linear-gradient(135deg, #e53e3e 0%, #c53030 100%)'
                                }}
                            >
                                <i className="fas fa-refresh"></i>
                                Réinitialiser
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Composant des résultats
        function ResultsSection({ 
            results, loading, pagination, handleSearch, 
            sortBy, setSortBy, sortDirection, setSortDirection 
        }) {
            if (loading) {
                return (
                    <div className="results-section">
                        <div className="loading">
                            <i className="fas fa-spinner"></i>
                            <p>Recherche en cours...</p>
                        </div>
                    </div>
                );
            }

            if (!results.length && !loading) {
                return (
                    <div className="results-section">
                        <div className="empty-state">
                            <i className="fas fa-utensils"></i>
                            <h3>Aucun aliment trouvé</h3>
                            <p>Essayez de modifier vos critères de recherche</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="results-section">
                    <div className="results-header">
                        <div className="results-count">
                            {pagination.totalElements} aliment{pagination.totalElements > 1 ? 's' : ''} trouvé{pagination.totalElements > 1 ? 's' : ''}
                        </div>
                        
                        <div className="sort-controls">
                            <select
                                value={sortBy}
                                onChange={(e) => setSortBy(e.target.value)}
                                className="filter-select"
                            >
                                <option value="name">Nom</option>
                                <option value="calories">Calories</option>
                                <option value="protein">Protéines</option>
                            </select>
                            
                            <button
                                className="pagination-button"
                                onClick={() => setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')}
                            >
                                <i className={`fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'}`}></i>
                            </button>
                        </div>
                    </div>

                    <div className="food-grid">
                        {results.map((food, index) => (
                            <FoodCard key={food.uri || index} food={food} />
                        ))}
                    </div>

                    {pagination.totalPages > 1 && (
                        <Pagination 
                            pagination={pagination} 
                            handleSearch={handleSearch} 
                        />
                    )}
                </div>
            );
        }

        // Composant carte d'aliment
        function FoodCard({ food }) {
            const getImageUrl = () => {
    if (food.images && food.images.length > 0) {
        let imagePath = food.images[0].imagePath;
        
        console.log("=== FRONTEND DEBUG ===");
        console.log("Food name:", food.name);
        console.log("Original path from DB:", imagePath);
        
        // Nettoyer le chemin
        if (imagePath.startsWith('images/')) {
            imagePath = imagePath.substring(7);
            console.log("After removing 'images/':", imagePath);
        }
        
        if (imagePath.startsWith('/')) {
            imagePath = imagePath.substring(1);
            console.log("After removing leading '/':", imagePath);
        }
        
        const finalUrl = `${API_BASE_URL}/images/${imagePath}`;
        console.log("Final URL:", finalUrl);
        console.log("======================");
        
        return finalUrl;
    }
    return null;
};

            return (
                <div className="food-card">
                    <div className="food-image">
                        {getImageUrl() ? (
                            <img 
    src={getImageUrl()} 
    alt={food.name}
    style={{ width: '100%', height: '100%', objectFit: 'cover' }}
    onLoad={() => {
        console.log("✅ Image loaded successfully:", food.name, getImageUrl());
    }}
    onError={(e) => {
        console.error("❌ Image failed to load:", food.name, getImageUrl());
        console.error("Error details:", e);
        // Essayer de fetch l'image pour voir l'erreur HTTP
        fetch(getImageUrl())
            .then(response => {
                console.log("Fetch response status:", response.status);
                console.log("Fetch response headers:", Object.fromEntries(response.headers.entries()));
            })
            .catch(err => console.error("Fetch error:", err));
        
        e.target.style.display = 'none';
        e.target.parentElement.innerHTML = '<i class="fas fa-utensils"></i>';
    }}
/>
                        ) : (
                            <i className="fas fa-utensils"></i>
                        )}
                    </div>
                    
                    <div className="food-card-content">
                        <h3 className="food-name">{food.name}</h3>
                        
                        {food.classLabel && (
                            <span className="food-class">{food.classLabel}</span>
                        )}
                        
                        {food.description && (
                            <p style={{ 
                                color: '#718096', 
                                fontSize: '0.9rem', 
                                lineHeight: '1.4',
                                marginBottom: '1rem',
                                maxHeight: '3em',
                                overflow: 'hidden'
                            }}>
                                {food.description}
                            </p>
                        )}

                        <div className="nutrition-grid">
                            {food.calories !== undefined && (
                                <div className="nutrition-item">
                                    <div className="nutrition-value">{Math.round(food.calories)}</div>
                                    <div className="nutrition-label">Calories</div>
                                </div>
                            )}
                            
                            {food.protein !== undefined && (
                                <div className="nutrition-item">
                                    <div className="nutrition-value">{food.protein?.toFixed(1)}g</div>
                                    <div className="nutrition-label">Protéines</div>
                                </div>
                            )}
                            
                            {food.carbohydrates !== undefined && (
                                <div className="nutrition-item">
                                    <div className="nutrition-value">{food.carbohydrates?.toFixed(1)}g</div>
                                    <div className="nutrition-label">Glucides</div>
                                </div>
                            )}
                            
                            {food.fat !== undefined && (
                                <div className="nutrition-item">
                                    <div className="nutrition-value">{food.fat?.toFixed(1)}g</div>
                                    <div className="nutrition-label">Lipides</div>
                                </div>
                            )}
                        </div>

                        {food.searchScore && (
                            <div style={{ 
                                marginTop: '1rem', 
                                fontSize: '0.8rem', 
                                color: '#a0aec0',
                                textAlign: 'right'
                            }}>
                                Score: {(food.searchScore * 100).toFixed(0)}%
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Composant pagination
        function Pagination({ pagination, handleSearch }) {
            const getPageNumbers = () => {
                const pages = [];
                const { currentPage, totalPages } = pagination;
                
                // Afficher au maximum 7 pages
                let startPage = Math.max(0, currentPage - 3);
                let endPage = Math.min(totalPages - 1, startPage + 6);
                
                if (endPage - startPage < 6) {
                    startPage = Math.max(0, endPage - 6);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    pages.push(i);
                }
                
                return pages;
            };

            return (
                <div className="pagination">
                    <button
                        className="pagination-button"
                        onClick={() => handleSearch(0)}
                        disabled={pagination.currentPage === 0}
                    >
                        <i className="fas fa-angle-double-left"></i>
                    </button>
                    
                    <button
                        className="pagination-button"
                        onClick={() => handleSearch(pagination.currentPage - 1)}
                        disabled={pagination.currentPage === 0}
                    >
                        <i className="fas fa-angle-left"></i>
                    </button>

                    {getPageNumbers().map(pageNum => (
                        <button
                            key={pageNum}
                            className={`pagination-button ${pageNum === pagination.currentPage ? 'active' : ''}`}
                            onClick={() => handleSearch(pageNum)}
                        >
                            {pageNum + 1}
                        </button>
                    ))}

                    <button
                        className="pagination-button"
                        onClick={() => handleSearch(pagination.currentPage + 1)}
                        disabled={pagination.currentPage >= pagination.totalPages - 1}
                    >
                        <i className="fas fa-angle-right"></i>
                    </button>
                    
                    <button
                        className="pagination-button"
                        onClick={() => handleSearch(pagination.totalPages - 1)}
                        disabled={pagination.currentPage >= pagination.totalPages - 1}
                    >
                        <i className="fas fa-angle-double-right"></i>
                    </button>
                </div>
            );
        }

        // Composant modal pour les détails d'un aliment
        function FoodDetailModal({ food, isOpen, onClose }) {
            if (!isOpen || !food) return null;

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2>{food.name}</h2>
                            <button className="modal-close" onClick={onClose}>
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div className="modal-body">
                            {food.images && food.images.length > 0 && (
                                <div className="modal-image">
                                    <img src={`${API_BASE_URL}/${food.images[0].imagePath}`} alt={food.name} />
                                </div>
                            )}
                            
                            <div className="modal-info">
                                {food.description && (
                                    <p className="food-description">{food.description}</p>
                                )}
                                
                                {food.classLabel && (
                                    <div className="info-item">
                                        <strong>Classe:</strong> {food.classLabel}
                                    </div>
                                )}
                                
                                {food.foodGroup && (
                                    <div className="info-item">
                                        <strong>Groupe:</strong> {food.foodGroup}
                                    </div>
                                )}
                                
                                <div className="nutrition-details">
                                    <h3>Informations nutritionnelles (pour 100g)</h3>
                                    <div className="nutrition-table">
                                        {food.calories !== undefined && (
                                            <div className="nutrition-row">
                                                <span>Calories</span>
                                                <span>{Math.round(food.calories)} kcal</span>
                                            </div>
                                        )}
                                        {food.protein !== undefined && (
                                            <div className="nutrition-row">
                                                <span>Protéines</span>
                                                <span>{food.protein?.toFixed(1)} g</span>
                                            </div>
                                        )}
                                        {food.carbohydrates !== undefined && (
                                            <div className="nutrition-row">
                                                <span>Glucides</span>
                                                <span>{food.carbohydrates?.toFixed(1)} g</span>
                                            </div>
                                        )}
                                        {food.fat !== undefined && (
                                            <div className="nutrition-row">
                                                <span>Lipides</span>
                                                <span>{food.fat?.toFixed(1)} g</span>
                                            </div>
                                        )}
                                        {food.fiber !== undefined && (
                                            <div className="nutrition-row">
                                                <span>Fibres</span>
                                                <span>{food.fiber?.toFixed(1)} g</span>
                                            </div>
                                        )}
                                        {food.sodium !== undefined && (
                                            <div className="nutrition-row">
                                                <span>Sodium</span>
                                                <span>{food.sodium?.toFixed(1)} mg</span>
                                            </div>
                                        )}
                                        {food.sugar !== undefined && (
                                            <div className="nutrition-row">
                                                <span>Sucres</span>
                                                <span>{food.sugar?.toFixed(1)} g</span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                {food.ingredients && food.ingredients.length > 0 && (
                                    <div className="ingredients-section">
                                        <h3>Ingrédients</h3>
                                        <div className="ingredients-list">
                                            {food.ingredients.map((ingredient, index) => (
                                                <span key={index} className="ingredient-tag">
                                                    {ingredient}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Composant section d'administration
       // Composant section d'administration AMÉLIORÉ
function AdminSection() {
    const [indexStats, setIndexStats] = useState(null);
    const [reindexing, setReindexing] = useState(false);
    const [loadingStats, setLoadingStats] = useState(true);
    const [statistics, setStatistics] = useState({
        totalAliments: 0,
        totalClasses: 0,
        totalGroupes: 0
    });

    // Charger les statistiques au montage du composant
    useEffect(() => {
        loadStatistics();
    }, []);

    const loadStatistics = async () => {
        setLoadingStats(true);
        try {
            // Charger les statistiques en parallèle
            const [indexStatsResponse, classesResponse, groupsResponse] = await Promise.all([
                fetch(`${API_BASE_URL}/foods/stats`),
                fetch(`${API_BASE_URL}/foods/classes`),
                fetch(`${API_BASE_URL}/foods/groups`)
            ]);

            const indexData = await indexStatsResponse.json();
            const classesData = await classesResponse.json();
            const groupsData = await groupsResponse.json();

            setIndexStats(indexData);
            setStatistics({
                totalAliments: indexData.totalDocuments || 0,
                totalClasses: classesData.length || 0,
                totalGroupes: groupsData.length || 0
            });

            console.log("📊 Statistics loaded:", {
                aliments: indexData.totalDocuments,
                classes: classesData.length,
                groupes: groupsData.length
            });

        } catch (error) {
            console.error('❌ Erreur lors du chargement des statistiques:', error);
            // Statistiques par défaut en cas d'erreur
            setStatistics({
                totalAliments: '-',
                totalClasses: '-',
                totalGroupes: '-'
            });
        } finally {
            setLoadingStats(false);
        }
    };

    const handleReindex = async () => {
        setReindexing(true);
        try {
            const response = await fetch(`${API_BASE_URL}/foods/reindex`, {
                method: 'POST'
            });
            const message = await response.text();
            alert('✅ ' + message);
            
            // Recharger les statistiques après réindexation
            setTimeout(() => {
                loadStatistics();
            }, 1000);
            
        } catch (error) {
            console.error('❌ Erreur de réindexation:', error);
            alert('❌ Erreur lors de la réindexation');
        } finally {
            setReindexing(false);
        }
    };

    const handleConfigure = () => {
        // Redirection vers Fuseki avec URL dynamique
        const fusekiUrl = 'http://localhost:3030/#/dataset/food-kg-v2/query';
        console.log("🔗 Redirecting to Fuseki:", fusekiUrl);
        
        // Ouvrir dans un nouvel onglet
        window.open(fusekiUrl, '_blank', 'noopener,noreferrer');
    };

    const formatNumber = (num) => {
        if (typeof num === 'number') {
            return num.toLocaleString('fr-FR');
        }
        return num;
    };

    return (
        <div className="admin-section">
            <div className="admin-header">
                <h2>Administration du système</h2>
                <p>Gestion et maintenance du Food Knowledge Graph</p>
            </div>

            <div className="admin-cards">
                {/* Carte Index Lucene */}
                <div className="admin-card">
                    <div className="admin-card-header">
                        <i className="fas fa-database"></i>
                        <h3>Index Lucene</h3>
                    </div>
                    <div className="admin-card-content">
                        <p>Réindexer la base de données pour améliorer les performances de recherche.</p>
                        
                        {indexStats && (
                            <div className="index-details">
                                <small style={{ color: '#718096', display: 'block', margin: '0.5rem 0' }}>
                                    Documents indexés: <strong>{formatNumber(indexStats.totalDocuments)}</strong>
                                    {indexStats.deletedDocuments > 0 && (
                                        <span> • Supprimés: {formatNumber(indexStats.deletedDocuments)}</span>
                                    )}
                                </small>
                            </div>
                        )}
                        
                        <button 
                            className="admin-button primary"
                            onClick={handleReindex}
                            disabled={reindexing}
                        >
                            {reindexing ? (
                                <>
                                    <i className="fas fa-spinner fa-spin"></i>
                                    Réindexation en cours...
                                </>
                            ) : (
                                <>
                                    <i className="fas fa-refresh"></i>
                                    Réindexer
                                </>
                            )}
                        </button>
                    </div>
                </div>

                {/* Carte Statistiques AMÉLIORÉE */}
                <div className="admin-card">
                    <div className="admin-card-header">
                        <i className="fas fa-chart-bar"></i>
                        <h3>Statistiques</h3>
                        {loadingStats && (
                            <i className="fas fa-spinner fa-spin" style={{ marginLeft: 'auto' }}></i>
                        )}
                    </div>
                    <div className="admin-card-content">
                        <div className="stats-grid">
                            <div className="stat-item">
                                <div className={`stat-value ${loadingStats ? 'loading' : ''}`}>
                                    {loadingStats ? (
                                        <i className="fas fa-spinner fa-spin"></i>
                                    ) : (
                                        formatNumber(statistics.totalAliments)
                                    )}
                                </div>
                                <div className="stat-label">Aliments indexés</div>
                            </div>
                            <div className="stat-item">
                                <div className={`stat-value ${loadingStats ? 'loading' : ''}`}>
                                    {loadingStats ? (
                                        <i className="fas fa-spinner fa-spin"></i>
                                    ) : (
                                        formatNumber(statistics.totalClasses)
                                    )}
                                </div>
                                <div className="stat-label">Classes d'aliments</div>
                            </div>
                            <div className="stat-item">
                                <div className={`stat-value ${loadingStats ? 'loading' : ''}`}>
                                    {loadingStats ? (
                                        <i className="fas fa-spinner fa-spin"></i>
                                    ) : (
                                        formatNumber(statistics.totalGroupes)
                                    )}
                                </div>
                                <div className="stat-label">Groupes alimentaires</div>
                            </div>
                        </div>
                        
                        {/* Bouton de rechargement des stats */}
                        <button 
                            className="admin-button secondary"
                            onClick={loadStatistics}
                            disabled={loadingStats}
                            style={{ 
                                marginTop: '1rem',
                                fontSize: '0.9rem',
                                padding: '0.5rem 1rem'
                            }}
                        >
                            <i className={`fas fa-${loadingStats ? 'spinner fa-spin' : 'sync-alt'}`}></i>
                            Actualiser
                        </button>
                    </div>
                </div>

                {/* Carte Configuration AMÉLIORÉE */}
                <div className="admin-card">
                    <div className="admin-card-header">
                        <i className="fas fa-cog"></i>
                        <h3>Configuration</h3>
                    </div>
                    <div className="admin-card-content">
                        <p>Accéder à l'interface SPARQL Fuseki pour les requêtes avancées et la configuration du dataset.</p>
                        
                        <div className="config-info">
                            <small style={{ 
                                color: '#718096', 
                                display: 'block', 
                                margin: '0.5rem 0',
                                fontSize: '0.8rem'
                            }}>
                                <i className="fas fa-info-circle"></i> 
                                Dataset: <strong>food-kg-v2</strong>
                                <br />
                                <i className="fas fa-external-link-alt"></i> 
                                URL: localhost:3030
                            </small>
                        </div>
                        
                        <button 
                            className="admin-button secondary"
                            onClick={handleConfigure}
                        >
                            <i className="fas fa-external-link-alt"></i>
                            Ouvrir Fuseki
                        </button>
                    </div>
                </div>
            </div>

            {/* Section d'information supplémentaire */}
            <div className="admin-info-section">
                <div className="info-card">
                    <h4>🔍 Informations Système</h4>
                    <ul style={{ 
                        listStyle: 'none', 
                        padding: 0, 
                        fontSize: '0.9rem', 
                        color: '#718096' 
                    }}>
                        <li>• Backend API: {API_BASE_URL}</li>
                        <li>• SPARQL Endpoint: http://localhost:3030/food-kg-v2/sparql</li>
                        <li>• Index Lucene: Actif</li>
                        <li>• Images: Servies dynamiquement</li>
                    </ul>
                </div>
            </div>
        </div>
    );
}

        // Styles CSS additionnels pour les modales et l'administration
        const additionalStyles = `
        /* Styles additionnels pour la section Admin améliorée */

            .index-details {
                background: rgba(102, 126, 234, 0.1);
                padding: 0.75rem;
                border-radius: 0.5rem;
                border-left: 3px solid #667eea;
                margin: 1rem 0;
            }

            .config-info {
                background: #f7fafc;
                padding: 0.75rem;
                border-radius: 0.5rem;
                border-left: 3px solid #68d391;
                margin: 1rem 0;
            }

            .stat-value.loading {
                color: #a0aec0;
                animation: pulse 1.5s ease-in-out infinite;
            }

            @keyframes pulse {
                0%, 100% { opacity: 0.6; }
                50% { opacity: 1; }
            }

            .admin-info-section {
                margin-top: 2rem;
                background: #f7fafc;
                border-radius: 1rem;
                padding: 2rem;
                border: 1px solid #e2e8f0;
            }

            .info-card h4 {
                color: #2d3748;
                margin-bottom: 1rem;
                font-size: 1.1rem;
                font-weight: 600;
            }

            .info-card ul li {
                padding: 0.25rem 0;
                font-family: 'Courier New', monospace;
            }

            .admin-button.secondary {
                background: linear-gradient(135deg, #68d391, #48bb78);
            }

            .admin-button.secondary:hover {
                box-shadow: 0 10px 30px rgba(104, 211, 145, 0.3);
            }

            /* Responsive pour mobile */
            @media (max-width: 768px) {
                .admin-cards {
                    grid-template-columns: 1fr;
                }
                
                .stats-grid {
                    grid-template-columns: 1fr;
                }
                
                .admin-info-section {
                    padding: 1rem;
                }
            }
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(5px);
            }

            .modal-content {
                background: white;
                border-radius: 1.5rem;
                max-width: 800px;
                max-height: 90vh;
                overflow-y: auto;
                margin: 2rem;
                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 2rem 2rem 1rem;
                border-bottom: 1px solid #e2e8f0;
            }

            .modal-close {
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: #a0aec0;
                padding: 0.5rem;
                border-radius: 0.5rem;
                transition: all 0.3s ease;
            }

            .modal-close:hover {
                background: #f7fafc;
                color: #4a5568;
            }

            .modal-body {
                padding: 2rem;
            }

            .modal-image {
                text-align: center;
                margin-bottom: 2rem;
            }

            .modal-image img {
                max-width: 100%;
                max-height: 300px;
                border-radius: 1rem;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            .food-description {
                font-size: 1.1rem;
                line-height: 1.6;
                color: #4a5568;
                margin-bottom: 2rem;
            }

            .info-item {
                margin-bottom: 1rem;
                color: #4a5568;
            }

            .nutrition-details {
                margin-top: 2rem;
            }

            .nutrition-details h3 {
                font-size: 1.3rem;
                margin-bottom: 1rem;
                color: #2d3748;
                border-bottom: 2px solid #e2e8f0;
                padding-bottom: 0.5rem;
            }

            .nutrition-table {
                display: grid;
                gap: 0.75rem;
            }

            .nutrition-row {
                display: flex;
                justify-content: space-between;
                padding: 0.75rem 1rem;
                background: #f7fafc;
                border-radius: 0.75rem;
                border-left: 4px solid #667eea;
            }

            .ingredients-section {
                margin-top: 2rem;
            }

            .ingredients-section h3 {
                font-size: 1.3rem;
                margin-bottom: 1rem;
                color: #2d3748;
            }

            .ingredients-list {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .ingredient-tag {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 1rem;
                font-size: 0.9rem;
                font-weight: 500;
            }

            .admin-section {
                background: white;
                border-radius: 2rem;
                padding: 3rem;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            .admin-header {
                text-align: center;
                margin-bottom: 3rem;
            }

            .admin-header h2 {
                font-size: 2.5rem;
                font-weight: 800;
                background: linear-gradient(135deg, #667eea, #764ba2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                margin-bottom: 0.5rem;
            }

            .admin-header p {
                color: #718096;
                font-size: 1.1rem;
            }

            .admin-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 2rem;
            }

            .admin-card {
                background: #f7fafc;
                border-radius: 1.5rem;
                overflow: hidden;
                border: 1px solid #e2e8f0;
                transition: all 0.3s ease;
            }

            .admin-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }

            .admin-card-header {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 1.5rem;
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .admin-card-header i {
                font-size: 1.5rem;
            }

            .admin-card-header h3 {
                font-size: 1.2rem;
                font-weight: 600;
            }

            .admin-card-content {
                padding: 2rem;
            }

            .admin-button {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: 0.75rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-top: 1rem;
            }

            .admin-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            }

            .admin-button:disabled {
                opacity: 0.7;
                cursor: not-allowed;
                transform: none;
            }

            .admin-button.secondary {
                background: linear-gradient(135deg, #a0aec0, #718096);
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1rem;
                margin-top: 1rem;
            }

            .stat-item {
                text-align: center;
                padding: 1rem;
                background: white;
                border-radius: 1rem;
                border: 1px solid #e2e8f0;
            }

            .stat-value {
                font-size: 2rem;
                font-weight: 800;
                color: #667eea;
                margin-bottom: 0.5rem;
            }

            .stat-label {
                font-size: 0.8rem;
                color: #718096;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
        `;

        // Injecter les styles additionnels
        const styleElement = document.createElement('style');
        styleElement.textContent = additionalStyles;
        document.head.appendChild(styleElement);

        // Mise à jour du composant principal pour inclure la modale et l'administration
        const AppWithModal = () => {
            const [activeTab, setActiveTab] = useState('search');
            const [searchQuery, setSearchQuery] = useState('');
            const [filters, setFilters] = useState({
                foodClass: '',
                foodGroup: '',
                minCalories: '',
                maxCalories: '',
                minProtein: '',
                maxProtein: ''
            });
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [pagination, setPagination] = useState({
                currentPage: 0,
                totalPages: 0,
                totalElements: 0,
                size: 20
            });
            const [sortBy, setSortBy] = useState('name');
            const [sortDirection, setSortDirection] = useState('asc');
            const [foodClasses, setFoodClasses] = useState([]);
            const [foodGroups, setFoodGroups] = useState([]);
            const [autocomplete, setAutocomplete] = useState([]);
            const [showAutocomplete, setShowAutocomplete] = useState(false);
            const [selectedFood, setSelectedFood] = useState(null);
            const [showModal, setShowModal] = useState(false);

            // Charger les classes et groupes d'aliments
            useEffect(() => {
                Promise.all([
                    fetch(`${API_BASE_URL}/foods/classes`).then(r => r.json()),
                    fetch(`${API_BASE_URL}/foods/groups`).then(r => r.json())
                ]).then(([classes, groups]) => {
                    setFoodClasses(classes);
                    setFoodGroups(groups);
                }).catch(console.error);
            }, []);

            // Autocomplétion
            const handleAutocomplete = useCallback(async (query) => {
                if (query.length < 2) {
                    setAutocomplete([]);
                    setShowAutocomplete(false);
                    return;
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/foods/autocomplete?query=${encodeURIComponent(query)}`);
                    const suggestions = await response.json();
                    setAutocomplete(suggestions);
                    setShowAutocomplete(true);
                } catch (error) {
                    console.error('Erreur autocomplétion:', error);
                }
            }, []);

            // Recherche
            const handleSearch = async (page = 0) => {
                setLoading(true);
                try {
                    const searchParams = new URLSearchParams({
                        page: page.toString(),
                        size: pagination.size.toString(),
                        sortBy,
                        sortDirection
                    });

                    if (searchQuery.trim()) searchParams.append('query', searchQuery);
                    if (filters.foodClass) searchParams.append('foodClass', filters.foodClass);
                    if (filters.foodGroup) searchParams.append('foodGroup', filters.foodGroup);
                    if (filters.minCalories) searchParams.append('minCalories', filters.minCalories);
                    if (filters.maxCalories) searchParams.append('maxCalories', filters.maxCalories);
                    if (filters.minProtein) searchParams.append('minProtein', filters.minProtein);
                    if (filters.maxProtein) searchParams.append('maxProtein', filters.maxProtein);

                    const response = await fetch(`${API_BASE_URL}/foods/search?${searchParams}`);
                    const data = await response.json();

                    setResults(data.foods || []);
                    setPagination({
                        currentPage: data.currentPage || 0,
                        totalPages: data.totalPages || 0,
                        totalElements: data.totalElements || 0,
                        size: data.size || 20
                    });
                } catch (error) {
                    console.error('Erreur de recherche:', error);
                    setResults([]);
                } finally {
                    setLoading(false);
                }
            };

            const updateFilter = (key, value) => {
                setFilters(prev => ({ ...prev, [key]: value }));
            };

            const resetFilters = () => {
                setSearchQuery('');
                setFilters({
                    foodClass: '',
                    foodGroup: '',
                    minCalories: '',
                    maxCalories: '',
                    minProtein: '',
                    maxProtein: ''
                });
            };

            const handleFoodClick = async (food) => {
                try {
                    // Récupérer les détails complets de l'aliment
                    const response = await fetch(`${API_BASE_URL}/foods/${encodeURIComponent(food.uri)}`);
                    const detailedFood = await response.json();
                    setSelectedFood(detailedFood);
                    setShowModal(true);
                } catch (error) {
                    console.error('Erreur lors de la récupération des détails:', error);
                    setSelectedFood(food);
                    setShowModal(true);
                }
            };

            return (
                <div className="app-container">
                    <Header activeTab={activeTab} setActiveTab={setActiveTab} />
                    
                    <main className="main-content">
                        {activeTab === 'search' && (
                            <>
                                <SearchSection
                                    searchQuery={searchQuery}
                                    setSearchQuery={setSearchQuery}
                                    filters={filters}
                                    updateFilter={updateFilter}
                                    resetFilters={resetFilters}
                                    handleSearch={handleSearch}
                                    loading={loading}
                                    foodClasses={foodClasses}
                                    foodGroups={foodGroups}
                                    autocomplete={autocomplete}
                                    showAutocomplete={showAutocomplete}
                                    setShowAutocomplete={setShowAutocomplete}
                                    handleAutocomplete={handleAutocomplete}
                                />
                                
                                <ResultsSectionWithModal
                                    results={results}
                                    loading={loading}
                                    pagination={pagination}
                                    handleSearch={handleSearch}
                                    sortBy={sortBy}
                                    setSortBy={setSortBy}
                                    sortDirection={sortDirection}
                                    setSortDirection={setSortDirection}
                                    onFoodClick={handleFoodClick}
                                />
                            </>
                        )}
                        
                        {activeTab === 'admin' && <AdminSection />}
                    </main>

                    <FoodDetailModal
                        food={selectedFood}
                        isOpen={showModal}
                        onClose={() => setShowModal(false)}
                    />
                </div>
            );
        };

        // Composant des résultats avec support pour les clics
        function ResultsSectionWithModal({ 
            results, loading, pagination, handleSearch, 
            sortBy, setSortBy, sortDirection, setSortDirection, onFoodClick 
        }) {
            if (loading) {
                return (
                    <div className="results-section">
                        <div className="loading">
                            <i className="fas fa-spinner"></i>
                            <p>Recherche en cours...</p>
                        </div>
                    </div>
                );
            }

            if (!results.length && !loading) {
                return (
                    <div className="results-section">
                        <div className="empty-state">
                            <i className="fas fa-utensils"></i>
                            <h3>Aucun aliment trouvé</h3>
                            <p>Essayez de modifier vos critères de recherche</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="results-section">
                    <div className="results-header">
                        <div className="results-count">
                            {pagination.totalElements} aliment{pagination.totalElements > 1 ? 's' : ''} trouvé{pagination.totalElements > 1 ? 's' : ''}
                        </div>
                        
                        <div className="sort-controls">
                            <select
                                value={sortBy}
                                onChange={(e) => setSortBy(e.target.value)}
                                className="filter-select"
                            >
                                <option value="name">Nom</option>
                                <option value="calories">Calories</option>
                                <option value="protein">Protéines</option>
                            </select>
                            
                            <button
                                className="pagination-button"
                                onClick={() => setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')}
                            >
                                <i className={`fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'}`}></i>
                            </button>
                        </div>
                    </div>

                    <div className="food-grid">
                        {results.map((food, index) => (
                            <div key={food.uri || index} onClick={() => onFoodClick(food)}>
                                <FoodCard food={food} />
                            </div>
                        ))}
                    </div>

                    {pagination.totalPages > 1 && (
                        <Pagination 
                            pagination={pagination} 
                            handleSearch={handleSearch} 
                        />
                    )}
                </div>
            );
        }

        // Rendu de l'application
        ReactDOM.render(<AppWithModal />, document.getElementById('root'));
    </script>
</body>
</html>